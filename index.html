<!doctype html>
<html>
    <head>
        <!--<script src="less.js" type="text/javascript"></script>
        <link rel="stylesheet/less" type="text/css"
        href="public/bootstrap/lib/bootstrap.less">-->
        <link rel="stylesheet" href="http://twitter.github.com/bootstrap/assets/css/bootstrap-1.1.0.min.css">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io.connect('http://localhost');
            socket.emit('client-connect', 'ok');

            // When image arrive, display it
            socket.on('image', function(json) {
                $('#imagewrapper').empty();
                $('#imagewrapper').append(json);
                //var json = JSON.parse(data);
                console.log(json);
            });

            socket.on('image-list', function(json) {
                var images = JSON.parse(json);
                $.each(images, function (i, imageName) {
                    $('#imagelist').append('<li>' + imageName + '</li>');
                });
            });

            $(document).ready(function() {
                // When submit code button pressed
                $('#submitcode').click(function() {
                    var sourcecode = $('#sourcecode').val().replace(/[\s\r\n]+$/, '').replace(/\n/g, ' -');
                    var json = JSON.stringify({'sourcecode' : sourcecode});
                    // Emit an event to server with source code
                    socket.emit('sourcecode', json);
                });
            });
        </script>
    </head>
    <body>
        <div class="topbar">
            <div class="fill">
                <div class="container">
                    <h3><a href="#">graphik.us</a></h3>
                    <ul>
                        <li class="active"><a href="#image">Image</a></li>
                        <li><a href="#about">About</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="masthead">
            <div class="inner">
                <div class="container">
                    <h1>Bootstrap, from Twitter</h1>
                    <p class="lead">
                    Vamos editar algumas imagens legais <br />
                    Muito legal <br />
                    </p>
                    <div class="clearfix">
                        <h4>Images on server:</h4>
                        <ul id="imagelist"></ul>
                    </div>
                </div>
            </div>
        </div>

        <section id="image-editor" style="margin-left: 50px">
            <div class="row">
                <div class="span6 columns">
                    <div class="clearfix">
                        <label for="textarea">Sourcecode</label>
                        <div class="input">
                            <textarea id="sourcecode" class="xxlarge"
                                name="textarea", rows=20>marvin.png</textarea>
                            <span class="help-block">Write your code here!</span>
                            <br />
                            <button id="submitcode" class="btn primary" type="submit">Submit code!</button>
                        </div>
                    </div>
                </div>
                <div class="span5 columns">
                    <div id="imagewrapper"></div>
                </div>
            </div>
        </section>
    </body>
</html>
